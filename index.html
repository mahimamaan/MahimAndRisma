<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Gauntlet: Mahim vs Risma</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    backgroundImage: {
                        'stripes-yellow': 'repeating-linear-gradient(45deg, #eab308 0, #eab308 10px, #ca8a04 10px, #ca8a04 20px)',
                    },
                    dropShadow: {
                        'cyan': '0 0 10px rgba(34, 211, 238, 0.5)',
                        'fuchsia': '0 0 10px rgba(232, 121, 249, 0.5)',
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #020617; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 1. FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyActq9kgx7-L5aekuMom-a_f0gAM8fHpcw",
            authDomain: "the-gauntlet-bbe69.firebaseapp.com",
            projectId: "the-gauntlet-bbe69",
            storageBucket: "the-gauntlet-bbe69.firebasestorage.app",
            messagingSenderId: "201612027326",
            appId: "1:201612027326:web:c82ef80177d1a6b8a605ef",
            measurementId: "G-6Y9GFFQPDT"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- 2. ICONS ---
        const Plus = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const Minus = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/></svg>;
        const Swords = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"/><line x1="5" y1="14" x2="9" y2="18"/><line x1="7" y1="17" x2="4" y2="20"/><line x1="3" y1="19" x2="5" y2="21"/></svg>;
        const Trash2 = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const AlertCircle = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;
        const HeartHandshake = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08v0c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.18 0l2.9 2.27c.12.1.19.26.19.41v0a1 1 0 0 1-1 1h-2a1 1 0 0 0-1 1v0a1 1 0 0 0 1 1h2a1 1 0 0 1 1 1v0a1 1 0 0 1-1 1h-2a1 1 0 0 0-1 1v0a1 1 0 0 0 1 1h2a1 1 0 0 1 1 1v0a1 1 0 0 1-1 1h-2"/></svg>;
        const RefreshCw = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Gavel = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m14 13-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10"/><path d="m16 16 6-6"/><path d="m8 8 6-6"/><path d="m9 7 8 8"/><path d="m21 11-8-8"/></svg>;
        const Settings = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const X = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>;
        const Trophy = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const LogOut = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
        const Gamepad2 = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="6" x2="10" y1="12" y2="12"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect width="20" height="12" x="2" y="6" rx="2"/></svg>;
        const History = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 16"/><path d="M3 5v11h11"/><path d="M12 7v5l4 2"/></svg>;
        const Lock = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Calendar = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;


        // --- 3. DATA DEFAULTS ---
        const INITIAL_GAMES = [
          { id: 1, name: 'Exploding Kittens', mahimSeries: 1, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'contested', note: 'Mahim won match 1. Risma claims "trial run".', icon: 'üê±' },
          { id: 2, name: 'Pool', mahimSeries: 1, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'finished', note: 'Mahim dominates.', icon: 'üé±' },
          { id: 3, name: 'Table Tennis', mahimSeries: 0, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'active', note: 'Undecided.', icon: 'üèì' },
          { id: 4, name: 'Shithead', mahimSeries: 0, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'active', note: 'Card game chaos awaiting.', icon: 'üÉè' },
          { id: 5, name: 'Chess', mahimSeries: 0, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'active', note: 'Risma is likely to win.', icon: '‚ôüÔ∏è' },
          { id: 6, name: 'Mini Golf', mahimSeries: 1, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'active', note: 'Mahim has paper proof. Physical evidence.', icon: '‚õ≥' },
          { id: 7, name: 'UNO', mahimSeries: 1, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'active', note: 'Mahim won the first series (2-1).', icon: 'üåà' }
        ];

        const DEFAULT_FORFEITS = [
          "Do the washing up", "Buy the next round of drinks", "Cook a 3-course dinner", 
          "Give a 5-minute foot massage", "Watch winner's choice of movie", "Clean the bathroom", 
          "Buy winner a treat < ¬£5", "Admit you are wrong about everything"
        ];

        const ARCADE_GAMES = [
            "Quick Match", "Mario Kart", "Time Crisis", "Street Fighter II", 
            "Pac-Man", "Guitar Hero", "DDR", "Air Hockey", "Skeeball", 
            "Point Blank", "Crazy Taxi", "House of the Dead", "Tekken"
        ];

        // --- 4. ARCADE COMPONENT ---
        const ArcadeMode = ({ onCashOut, onExit }) => {
            // SAFETY NET 1: Initialize from LocalStorage if available
            const [score, setScore] = useState(() => {
                const saved = localStorage.getItem('gauntlet_arcade_score');
                return saved ? JSON.parse(saved) : { mahim: 0, risma: 0 };
            });
            const [history, setHistory] = useState(() => {
                const saved = localStorage.getItem('gauntlet_arcade_history');
                return saved ? JSON.parse(saved) : [];
            });

            const [gamesList, setGamesList] = useState(ARCADE_GAMES);
            const [selectedGame, setSelectedGame] = useState("Quick Match");
            const [isAddGameOpen, setIsAddGameOpen] = useState(false);
            const [newGameName, setNewGameName] = useState("");
            const [isCashOutConfirm, setIsCashOutConfirm] = useState(false);

            // SAFETY NET 2: Save to LocalStorage on every change
            useEffect(() => {
                localStorage.setItem('gauntlet_arcade_score', JSON.stringify(score));
                localStorage.setItem('gauntlet_arcade_history', JSON.stringify(history));
            }, [score, history]);

            const handleWin = (winner) => {
                const newScore = { ...score, [winner]: score[winner] + 1 };
                setScore(newScore);
                const logEntry = {
                    id: Date.now(),
                    winner,
                    game: selectedGame,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                };
                setHistory([logEntry, ...history]);
            };

            // Clear session data only on Cash Out
            const confirmCashOut = (winner) => {
                localStorage.removeItem('gauntlet_arcade_score');
                localStorage.removeItem('gauntlet_arcade_history');
                onCashOut(winner);
            }

            const addCustomGame = (e) => {
                e.preventDefault();
                if (newGameName.trim()) {
                    const name = newGameName.trim();
                    setGamesList([...gamesList, name]);
                    setSelectedGame(name);
                    setNewGameName("");
                    setIsAddGameOpen(false);
                }
            };

            const getWinnerColor = (w) => w === 'mahim' ? 'text-cyan-400' : 'text-fuchsia-400';

            // Final screen before returning to main app
            if (isCashOutConfirm) {
                const winner = score.mahim > score.risma ? 'Mahim' : score.risma > score.mahim ? 'Risma' : 'Draw';
                return (
                    <div className="min-h-screen bg-black text-white font-mono flex flex-col items-center justify-center p-6 relative overflow-hidden">
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-10 pointer-events-none bg-[length:100%_4px,6px_100%]"></div>
                        <div className="z-20 text-center space-y-8 animate-in zoom-in duration-500">
                            <h1 className="text-4xl font-black uppercase tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-white to-fuchsia-400">GAME OVER</h1>
                            <div className="bg-gray-900 border-2 border-white/20 p-8 rounded-xl shadow-[0_0_30px_rgba(255,255,255,0.1)]">
                                <div className="text-xs text-gray-500 mb-2 uppercase tracking-widest">Session Winner</div>
                                <div className={`text-6xl font-black ${winner === 'Mahim' ? 'text-cyan-400' : winner === 'Risma' ? 'text-fuchsia-400' : 'text-white'}`}>{winner}</div>
                                <div className="text-xl mt-4 font-bold text-gray-400">{score.mahim} - {score.risma}</div>
                            </div>
                            <div className="flex gap-4 justify-center">
                                <button onClick={() => setIsCashOutConfirm(false)} className="text-xs text-gray-500 hover:text-white uppercase tracking-widest">Cancel</button>
                                <button onClick={() => confirmCashOut(winner)} className="px-8 py-3 bg-white text-black font-black uppercase tracking-widest hover:bg-gray-200 transition-colors">CONFIRM & EXIT</button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-black text-white font-mono flex flex-col relative overflow-hidden selection:bg-pink-500/50">
                    <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_50%_0%,rgba(120,50,255,0.2),transparent_70%)] pointer-events-none"></div>
                    <div className="absolute bottom-0 right-0 w-full h-full bg-[radial-gradient(circle_at_100%_100%,rgba(255,0,255,0.15),transparent_50%)] pointer-events-none"></div>
                    
                    <header className="flex justify-between items-center p-4 z-20 border-b border-white/10 bg-black/50 backdrop-blur">
                        <div className="flex items-center gap-3">
                            <button onClick={onExit} className="text-gray-600 hover:text-white transition-colors"><X size={20} /></button>
                            <div className="flex items-center gap-2"><Gamepad2 className="text-yellow-400 animate-pulse" /><span className="font-bold tracking-widest text-yellow-400 uppercase">NQ64 MODE</span></div>
                        </div>
                        <button onClick={() => setIsCashOutConfirm(true)} className="text-xs font-bold border border-red-500/50 text-red-400 px-3 py-1 rounded hover:bg-red-500/10 transition-colors uppercase tracking-wider">Cash Out</button>
                    </header>

                    <div className="p-4 z-20">
                        <div className="flex gap-3 overflow-x-auto pb-4 scrollbar-hide snap-x items-center">
                            <button onClick={() => setIsAddGameOpen(true)} className="flex-shrink-0 w-10 h-10 rounded-full border border-yellow-500/50 text-yellow-500 flex items-center justify-center hover:bg-yellow-500/20 active:scale-95 transition-all snap-center bg-black"><Plus size={20} /></button>
                            {gamesList.map(game => (
                                <button key={game} onClick={() => setSelectedGame(game)} className={`flex-shrink-0 px-4 py-2 rounded-full border text-sm font-bold uppercase tracking-wider transition-all snap-center whitespace-nowrap ${selectedGame === game ? 'bg-white text-black border-white shadow-[0_0_15px_rgba(255,255,255,0.5)] scale-105' : 'bg-black text-gray-500 border-gray-800 hover:border-gray-600'}`}>{game}</button>
                            ))}
                        </div>
                    </div>

                    <main className="flex-1 flex flex-col justify-center p-4 gap-4 z-20 relative">
                        <div className="flex justify-between items-end px-4 mb-2">
                            <div className="text-center"><div className="text-6xl font-black text-cyan-400 drop-shadow-[0_0_15px_rgba(34,211,238,0.6)] leading-none">{score.mahim}</div><div className="text-xs font-bold text-cyan-500/50 uppercase tracking-[0.2em] mt-2">Mahim</div></div>
                            <div className="text-gray-700 text-4xl font-thin italic pb-2">VS</div>
                            <div className="text-center"><div className="text-6xl font-black text-fuchsia-400 drop-shadow-[0_0_15px_rgba(232,121,249,0.6)] leading-none">{score.risma}</div><div className="text-xs font-bold text-fuchsia-500/50 uppercase tracking-[0.2em] mt-2">Risma</div></div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 h-64">
                            <button onClick={() => handleWin('mahim')} className="relative group bg-slate-900 rounded-2xl border-2 border-cyan-500/30 overflow-hidden active:scale-95 transition-all"><div className="absolute inset-0 bg-cyan-500/10 group-hover:bg-cyan-500/20 transition-colors"></div><div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-4xl mb-2">üïπÔ∏è</span><span className="font-black text-cyan-400 uppercase tracking-widest text-lg">Mahim<br/>Wins</span></div><div className="absolute bottom-0 w-full h-1 bg-cyan-500 shadow-[0_0_10px_#22d3ee]"></div></button>
                            <button onClick={() => handleWin('risma')} className="relative group bg-slate-900 rounded-2xl border-2 border-fuchsia-500/30 overflow-hidden active:scale-95 transition-all"><div className="absolute inset-0 bg-fuchsia-500/10 group-hover:bg-fuchsia-500/20 transition-colors"></div><div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-4xl mb-2">üëæ</span><span className="font-black text-fuchsia-400 uppercase tracking-widest text-lg">Risma<br/>Wins</span></div><div className="absolute bottom-0 w-full h-1 bg-fuchsia-500 shadow-[0_0_10px_#e879f9]"></div></button>
                        </div>
                    </main>

                    <div className="h-48 bg-gray-900/50 border-t border-white/10 z-20 flex flex-col">
                        <div className="px-4 py-2 text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2"><History size={12} /> Session Log</div>
                        <div className="flex-1 overflow-y-auto px-4 pb-4 space-y-2">
                            {history.length === 0 && <div className="text-gray-600 text-center text-xs italic mt-4">No games played yet. Insert Coin.</div>}
                            {history.map(entry => (
                                <div key={entry.id} className="flex justify-between items-center text-xs border-b border-white/5 pb-2 animate-in slide-in-from-bottom-2"><div className="flex flex-col"><span className="text-gray-300 font-bold uppercase">{entry.game}</span><span className="text-gray-600 font-mono">{entry.time}</span></div><div className={`font-black uppercase tracking-wider ${getWinnerColor(entry.winner)}`}>{entry.winner} WON</div></div>
                            ))}
                        </div>
                    </div>

                    {isAddGameOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200">
                            <div className="bg-gray-900 border border-yellow-500/30 rounded-2xl w-full max-w-sm p-6 shadow-[0_0_50px_rgba(234,179,8,0.1)]">
                                <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold text-yellow-400 uppercase tracking-widest">New Challenger</h2><button onClick={() => setIsAddGameOpen(false)} className="text-gray-500 hover:text-white"><X size={24}/></button></div>
                                <form onSubmit={addCustomGame} className="space-y-4">
                                    <input autoFocus type="text" value={newGameName} onChange={(e) => setNewGameName(e.target.value)} placeholder="Game Name..." className="w-full bg-black border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-yellow-400 outline-none uppercase tracking-wider font-mono" />
                                    <button type="submit" className="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-black uppercase tracking-widest py-3 rounded-lg transition-colors">Add Game</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- 5. LOGIN COMPONENT ---
        const LoginScreen = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                auth.signInWithEmailAndPassword(email, password)
                    .catch(err => setError("Invalid credentials. Access denied."));
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-slate-950">
                    <div className="w-full max-w-md bg-slate-900 border border-slate-800 rounded-2xl p-8 shadow-2xl">
                        <div className="text-center mb-8"><div className="inline-block p-3 bg-cyan-500/10 rounded-xl mb-4"><Swords className="w-8 h-8 text-cyan-400" /></div><h1 className="text-2xl font-black text-white mb-1">THE GAUNTLET</h1><p className="text-slate-500 text-sm">Mahim vs Risma</p></div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">Email</label><input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:border-cyan-500 outline-none transition-colors" placeholder="admin@gauntlet.com" /></div>
                            <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">Password</label><input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:border-cyan-500 outline-none transition-colors" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
                            {error && <div className="text-red-400 text-xs font-bold text-center">{error}</div>}
                            <button type="submit" className="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-lg transition-colors">Enter The Arena</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- NEW COMPONENT: SIDE PANEL ---
        const SidePanel = ({ isOpen, onClose, games }) => {
            // Filter games that are 'finished' to represent completed days/events
            const completedEvents = games.filter(g => g.status === 'finished').sort((a, b) => b.id - a.id);

            return (
                <div className={`fixed inset-y-0 right-0 z-50 w-80 bg-slate-900/95 border-l border-slate-800 backdrop-blur-xl transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : 'translate-x-full'} shadow-2xl`}>
                    <div className="p-6 h-full flex flex-col">
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-xl font-bold text-white flex items-center gap-2">
                                <Calendar className="text-cyan-400" />
                                <span>Event Log</span>
                            </h2>
                            <button onClick={onClose} className="text-slate-500 hover:text-white transition-colors">
                                <X size={24} />
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto space-y-4">
                            {completedEvents.length === 0 ? (
                                <div className="text-center text-slate-600 text-sm italic mt-10">No completed events yet.</div>
                            ) : (
                                completedEvents.map(event => {
                                    // Handle legacy IDs (small numbers) vs Timestamps
                                    const isLegacy = event.id < 1000000;
                                    const dateDisplay = isLegacy ? "Archive" : new Date(event.id).toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
                                    
                                    return (
                                        <div key={event.id} className="bg-slate-800/50 rounded-xl p-4 border border-slate-700 hover:border-cyan-500/30 transition-colors">
                                            <div className="flex justify-between items-start mb-2">
                                                <h3 className="font-bold text-slate-200 text-sm">{event.name}</h3>
                                                <span className="text-[10px] font-mono text-slate-500 bg-slate-900 px-2 py-1 rounded">
                                                    {dateDisplay}
                                                </span>
                                            </div>
                                            <div className="flex items-center gap-3 text-sm mb-2">
                                                <span className={event.mahimSeries > event.rismaSeries ? "text-cyan-400 font-bold" : "text-slate-500"}>
                                                    Mahim {event.mahimSeries}
                                                </span>
                                                <span className="text-slate-700 font-light text-xs">vs</span>
                                                <span className={event.rismaSeries > event.mahimSeries ? "text-fuchsia-400 font-bold" : "text-slate-500"}>
                                                    Risma {event.rismaSeries}
                                                </span>
                                            </div>
                                            {event.note && <p className="text-xs text-slate-400 italic">"{event.note}"</p>}
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 6. MAIN APP COMPONENT ---
        const App = () => {
          const [user, setUser] = useState(null);
          const [loading, setLoading] = useState(true);
          const [games, setGames] = useState([]);
          const [forfeits, setForfeits] = useState([]);
          
          // STATE
          const [isArcadeMode, setIsArcadeMode] = useState(false);
          const [isSecretModalOpen, setIsSecretModalOpen] = useState(false);
          const [secretCode, setSecretCode] = useState('');
          const [isSidebarOpen, setIsSidebarOpen] = useState(false);
          
          const [isArcadeFeatureUnlocked, setIsArcadeFeatureUnlocked] = useState(() => {
              return localStorage.getItem('gauntlet_arcade_unlocked') === 'true';
          });
          
          // Auth Listener
          useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(u => {
                setUser(u);
                setLoading(false);
            });
            return unsubscribe;
          }, []);

          // Firestore Listeners
          useEffect(() => {
            if (!user) return;
            const initDb = async () => {
                const gamesRef = db.collection('championships').doc('main_event');
                const doc = await gamesRef.get();
                if (!doc.exists) { await gamesRef.set({ games: INITIAL_GAMES }); }
                const forfeitsRef = db.collection('championships').doc('forfeits');
                const fDoc = await forfeitsRef.get();
                if (!fDoc.exists) { await forfeitsRef.set({ list: DEFAULT_FORFEITS }); }
            };
            initDb();
            const unsubGames = db.collection('championships').doc('main_event').onSnapshot(doc => { if (doc.exists) setGames(doc.data().games || []); });
            const unsubForfeits = db.collection('championships').doc('forfeits').onSnapshot(doc => { if (doc.exists) setForfeits(doc.data().list || []); });
            return () => { unsubGames(); unsubForfeits(); };
          }, [user]);

          const saveGames = (newGames) => { db.collection('championships').doc('main_event').update({ games: newGames }); };
          const saveForfeits = (newList) => { db.collection('championships').doc('forfeits').update({ list: newList }); };

          // Standard App Logic
          const handleBoutChange = (id, player, delta) => {
            const updated = games.map(g => {
              if (g.id !== id) return g;
              const currentScore = player === 'mahim' ? g.mahimBout : g.rismaBout;
              if (delta < 0 && currentScore === 0) return g;
              return { ...g, [player === 'mahim' ? 'mahimBout' : 'rismaBout']: currentScore + delta };
            });
            saveGames(updated);
          };

          const claimSeriesWin = (id, winner) => {
            const updated = games.map(g => {
              if (g.id !== id) return g;
              return { ...g, mahimSeries: winner === 'mahim' ? g.mahimSeries + 1 : g.mahimSeries, rismaSeries: winner === 'risma' ? g.rismaSeries + 1 : g.rismaSeries, mahimBout: 0, rismaBout: 0 };
            });
            saveGames(updated);
          };

          const adjustSeriesManual = (id, player, delta) => {
            const updated = games.map(g => {
              if (g.id !== id) return g;
              const current = player === 'mahim' ? g.mahimSeries : g.rismaSeries;
              if (delta < 0 && current === 0) return g;
              return { ...g, [player === 'mahim' ? 'mahimSeries' : 'rismaSeries']: current + delta };
            });
            saveGames(updated);
          };

          const updateNote = (id, newNote) => { const updated = games.map(game => game.id === id ? { ...game, note: newNote } : game); saveGames(updated); };
          const addNewGame = (e) => { e.preventDefault(); if (!newGameName.trim()) return; const newGame = { id: Date.now(), name: newGameName, mahimSeries: 0, rismaSeries: 0, mahimBout: 0, rismaBout: 0, status: 'active', note: 'New challenger approaches!', icon: newGameIcon }; saveGames([...games, newGame]); setNewGameName(''); setIsAddModalOpen(false); };
          const deleteGame = (id) => { if(confirm("Are you sure you want to delete this game completely?")) { saveGames(games.filter(g => g.id !== id)); }};
          const resolveDispute = () => { if (activeDisputeGame) { const updated = games.map(g => g.id === activeDisputeGame.id ? { ...g, status: 'active', note: `${g.note} (Resolved by Supreme Court)` } : g); saveGames(updated); setIsDisputeOpen(false); setActiveDisputeGame(null); }};
          const addForfeit = (e) => { e.preventDefault(); if (newForfeit.trim()) { saveForfeits([...forfeits, newForfeit.trim()]); setNewForfeit(''); }};
          const removeForfeit = (item) => { saveForfeits(forfeits.filter(f => f !== item)); };

          // ARCADE MODE HANDLERS
          const handleSecretSubmit = (e) => {
              e.preventDefault();
              const code = secretCode.toUpperCase();
              
              if (code === 'NQ64') {
                  setIsArcadeMode(true);
                  setIsSecretModalOpen(false);
                  setIsArcadeFeatureUnlocked(true);
                  localStorage.setItem('gauntlet_arcade_unlocked', 'true');
              } 
              else if (code === 'LOCK') {
                  setIsArcadeFeatureUnlocked(false);
                  setIsSecretModalOpen(false);
                  localStorage.removeItem('gauntlet_arcade_unlocked');
                  alert("SYSTEM LOCKED. PROTOCOL 64 DEACTIVATED.");
              }
              else {
                  alert("ACCESS DENIED");
              }
              setSecretCode('');
          };

          const handleArcadeCashOut = (winner) => {
              setIsArcadeMode(false);
              if (winner !== 'Draw') {
                  const arcadeGameCard = {
                      id: Date.now(),
                      name: 'NQ64 Arcade Night',
                      mahimSeries: winner === 'Mahim' ? 1 : 0,
                      rismaSeries: winner === 'Risma' ? 1 : 0,
                      mahimBout: 0,
                      rismaBout: 0,
                      status: 'finished',
                      note: `Arcade Mode Champion: ${winner}.`,
                      icon: 'üïπÔ∏è'
                  };
                  saveGames([...games, arcadeGameCard]);
                  setIsSidebarOpen(true); // Open sidebar automatically to show new entry
              }
          };

          const [isAddModalOpen, setIsAddModalOpen] = useState(false);
          const [isWheelOpen, setIsWheelOpen] = useState(false);
          const [isDisputeOpen, setIsDisputeOpen] = useState(false);
          const [activeDisputeGame, setActiveDisputeGame] = useState(null);
          const [newGameName, setNewGameName] = useState('');
          const [newGameIcon, setNewGameIcon] = useState('üèÜ');
          const [newForfeit, setNewForfeit] = useState('');
          const [wheelResult, setWheelResult] = useState(null);
          const [isSpinning, setIsSpinning] = useState(false);

          const mahimTotal = games.filter(g => g.mahimSeries > g.rismaSeries).length;
          const rismaTotal = games.filter(g => g.rismaSeries > g.mahimSeries).length;

          const spinWheel = () => { if (isSpinning) return; setIsSpinning(true); setWheelResult(null); let spins = 0; const maxSpins = 20 + Math.floor(Math.random() * 10); const interval = setInterval(() => { spins++; const randomIndex = Math.floor(Math.random() * forfeits.length); setWheelResult(forfeits[randomIndex]); if (spins >= maxSpins) { clearInterval(interval); setIsSpinning(false); } }, 100); };
          const getLeader = (m, r) => { if (m > r) return { text: 'Mahim Leads Series', color: 'text-cyan-400', border: 'border-cyan-500/50' }; if (r > m) return { text: 'Risma Leads Series', color: 'text-fuchsia-400', border: 'border-fuchsia-500/50' }; return { text: 'Series Level', color: 'text-gray-400', border: 'border-slate-700' }; };

          if (loading) return <div className="min-h-screen bg-slate-950 flex items-center justify-center text-cyan-500">Loading The Gauntlet...</div>;
          if (!user) return <LoginScreen onLogin={setUser} />;
          if (isArcadeMode) return <ArcadeMode onCashOut={handleArcadeCashOut} onExit={() => setIsArcadeMode(false)} />;

          return (
            <div className="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-fuchsia-500/30 pb-24 relative overflow-x-hidden">
              
              <SidePanel isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} games={games} />

              {/* Top Stats Bar */}
              <div className="bg-slate-900 border-b border-slate-800 sticky top-0 z-20 backdrop-blur-md bg-slate-900/90 shadow-xl">
                <div className="max-w-4xl mx-auto px-4 py-3">
                  <div className="flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <div className="bg-gradient-to-br from-cyan-500 to-blue-600 p-2 rounded-lg shadow-lg shadow-cyan-500/20"><Swords className="w-5 h-5 text-white" /></div>
                      <div><h1 className="text-lg font-black tracking-tight text-white">THE GAUNTLET</h1><p className="text-xs text-slate-400 font-medium">Mahim vs. Risma</p></div>
                    </div>
                    <div className="flex items-center gap-4">
                        <button onClick={() => setIsSidebarOpen(true)} className="p-2 text-slate-400 hover:text-white transition-colors" title="Event History"><Calendar size={20} /></button>
                        <div className="h-6 w-px bg-slate-800"></div>
                        <div className="flex items-center gap-4 mr-2">
                            <div className="text-center"><div className="text-2xl font-black text-cyan-400 leading-none">{mahimTotal}</div><div className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mt-1">Mahim</div></div>
                            <div className="h-8 w-px bg-slate-800"></div>
                            <div className="text-center"><div className="text-2xl font-black text-fuchsia-400 leading-none">{rismaTotal}</div><div className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mt-1">Risma</div></div>
                        </div>
                        <button onClick={() => auth.signOut()} className="p-2 text-slate-600 hover:text-white bg-slate-800 rounded-lg transition-colors" title="Log Out"><LogOut size={16} /></button>
                    </div>
                  </div>
                </div>
              </div>

              <main className="max-w-4xl mx-auto px-4 py-6 space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {games.map(game => {
                    const statusStyle = getLeader(game.mahimSeries, game.rismaSeries);
                    const isContested = game.status === 'contested';
                    return (
                      <div key={game.id} className={`group relative bg-slate-900 rounded-2xl border ${isContested ? 'border-yellow-500/50' : statusStyle.border} overflow-hidden shadow-xl flex flex-col`}>
                        {isContested && ( <div className="absolute top-0 inset-x-0 h-1 bg-yellow-500 z-10" /> )}
                        <div className="p-5 pb-4 bg-slate-900/50 relative z-10 border-b border-slate-800">
                          <div className="flex justify-between items-start mb-4">
                            <div className="flex gap-3 items-center">
                              <span className="text-4xl filter drop-shadow-lg">{game.icon}</span>
                              <div>
                                <h3 className="font-bold text-xl text-white tracking-tight">{game.name}</h3>
                                {isContested ? ( <span className="inline-flex items-center gap-1 text-[10px] font-bold uppercase text-yellow-500 bg-yellow-500/10 px-2 py-0.5 rounded border border-yellow-500/20"><AlertCircle size={10} />Disputed</span> ) : ( <p className={`text-[10px] font-bold tracking-wide uppercase ${statusStyle.color}`}>{statusStyle.text}</p> )}
                              </div>
                            </div>
                            <div className="flex gap-1">
                              {isContested && ( <button onClick={() => { setActiveDisputeGame(game); setIsDisputeOpen(true); }} className="p-2 bg-yellow-500/10 text-yellow-500 rounded hover:bg-yellow-500/20 transition-colors"><Gavel size={16} /></button> )}
                              <button onClick={() => deleteGame(game.id)} className="p-2 text-slate-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100"><Trash2 size={16} /></button>
                            </div>
                          </div>
                          <div className="flex items-end justify-between px-4">
                            <div className="flex flex-col items-center">
                              <div className="text-4xl font-black text-cyan-400 leading-none">{game.mahimSeries}</div>
                              <div className="flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity"><button onClick={() => adjustSeriesManual(game.id, 'mahim', -1)} className="text-slate-600 hover:text-white"><Minus size={12}/></button><span className="text-[9px] text-slate-500 font-bold uppercase">Series</span><button onClick={() => adjustSeriesManual(game.id, 'mahim', 1)} className="text-slate-600 hover:text-white"><Plus size={12}/></button></div>
                            </div>
                            <div className="text-slate-700 font-light text-2xl mb-4">vs</div>
                            <div className="flex flex-col items-center">
                              <div className="text-4xl font-black text-fuchsia-400 leading-none">{game.rismaSeries}</div>
                              <div className="flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity"><button onClick={() => adjustSeriesManual(game.id, 'risma', -1)} className="text-slate-600 hover:text-white"><Minus size={12}/></button><span className="text-[9px] text-slate-500 font-bold uppercase">Series</span><button onClick={() => adjustSeriesManual(game.id, 'risma', 1)} className="text-slate-600 hover:text-white"><Plus size={12}/></button></div>
                            </div>
                          </div>
                        </div>
                        <div className="bg-slate-950 p-5 flex-1 flex flex-col justify-between">
                          <div className="mb-4">
                            <div className="flex items-center justify-between text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3"><span>Current Bouts</span><span>Active Match</span></div>
                            <div className="bg-slate-900/50 rounded-xl p-1 flex items-center justify-between border border-slate-800/50">
                              <div className="flex items-center gap-3 p-2"><button onClick={() => handleBoutChange(game.id, 'mahim', -1)} className="w-8 h-8 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white flex items-center justify-center transition-colors"><Minus size={14} /></button><span className="text-xl font-bold text-cyan-400 tabular-nums w-6 text-center">{game.mahimBout}</span><button onClick={() => handleBoutChange(game.id, 'mahim', 1)} className="w-8 h-8 rounded-lg bg-cyan-500/10 hover:bg-cyan-500 text-cyan-500 hover:text-white flex items-center justify-center transition-all active:scale-95 border border-cyan-500/20 hover:border-transparent"><Plus size={14} /></button></div>
                              <div className="h-8 w-px bg-slate-800"></div>
                              <div className="flex items-center gap-3 p-2"><button onClick={() => handleBoutChange(game.id, 'risma', -1)} className="w-8 h-8 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white flex items-center justify-center transition-colors"><Minus size={14} /></button><span className="text-xl font-bold text-fuchsia-400 tabular-nums w-6 text-center">{game.rismaBout}</span><button onClick={() => handleBoutChange(game.id, 'risma', 1)} className="w-8 h-8 rounded-lg bg-fuchsia-500/10 hover:bg-fuchsia-500 text-fuchsia-500 hover:text-white flex items-center justify-center transition-all active:scale-95 border border-fuchsia-500/20 hover:border-transparent"><Plus size={14} /></button></div>
                            </div>
                          </div>
                          {(game.mahimBout > 0 || game.rismaBout > 0) && (
                            <div className="flex gap-2 mb-4 animate-in fade-in slide-in-from-top-2">
                              {game.mahimBout > game.rismaBout && ( <button onClick={() => claimSeriesWin(game.id, 'mahim')} className="flex-1 bg-cyan-600 hover:bg-cyan-500 text-white py-2 rounded-lg text-xs font-bold uppercase tracking-wide flex items-center justify-center gap-2 shadow-lg shadow-cyan-900/20 transition-colors"><Trophy size={14} /> Mahim wins set</button> )}
                              {game.rismaBout > game.mahimBout && ( <button onClick={() => claimSeriesWin(game.id, 'risma')} className="flex-1 bg-fuchsia-600 hover:bg-fuchsia-500 text-white py-2 rounded-lg text-xs font-bold uppercase tracking-wide flex items-center justify-center gap-2 shadow-lg shadow-fuchsia-900/20 transition-colors"><Trophy size={14} /> Risma wins set</button> )}
                              {game.mahimBout === game.rismaBout && ( <div className="flex-1 py-2 text-center text-[10px] text-slate-500 uppercase font-bold italic">Score tied</div> )}
                            </div>
                          )}
                          <div className="pt-2 border-t border-slate-800/50"><input type="text" value={game.note} onChange={(e) => updateNote(game.id, e.target.value)} className="w-full bg-transparent py-1 text-xs text-slate-400 focus:text-slate-200 focus:outline-none transition-colors placeholder:text-slate-700 italic" placeholder="Notes on this rivalry..." /></div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                {/* Action Buttons */}
                <div className="grid grid-cols-2 gap-4 sticky bottom-6 z-30">
                    <button onClick={() => setIsAddModalOpen(true)} className="bg-slate-800 hover:bg-slate-700 text-white py-4 rounded-xl font-bold shadow-lg border border-slate-700 flex items-center justify-center gap-2 transition-all active:scale-95"><Plus size={20} /> Add Game</button>
                    <button onClick={() => setIsWheelOpen(true)} className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-purple-500/20 flex items-center justify-center gap-2 transition-all active:scale-95"><RefreshCw size={20} /> Forfeit Wheel</button>
                </div>

                {/* THE PROTOCOL 64 BUTTON (SECRET) */}
                <div className="flex justify-center mt-8 mb-4">
                    {isArcadeFeatureUnlocked ? (
                        <button onClick={() => setIsArcadeMode(true)} className="text-yellow-500 hover:text-yellow-400 transition-colors animate-pulse-fast">
                            <Gamepad2 size={24} />
                        </button>
                    ) : (
                        <button onClick={() => setIsSecretModalOpen(true)} className="text-slate-800 hover:text-slate-700 transition-colors">
                            <Lock size={16} />
                        </button>
                    )}
                </div>
              </main>

              {/* MODALS */}
              {isAddModalOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200">
                  <div className="bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl w-full max-w-md p-6">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold text-white">New Battleground</h2><button onClick={() => setIsAddModalOpen(false)} className="text-slate-400 hover:text-white"><X size={24}/></button></div>
                    <form onSubmit={addNewGame} className="space-y-4">
                      <input autoFocus type="text" value={newGameName} onChange={(e) => setNewGameName(e.target.value)} placeholder="Game Name (e.g. Scrabble)" className="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-white focus:border-cyan-500 outline-none" />
                      <div className="grid grid-cols-6 gap-2">{['üèÜ','üé±','üèì','üè∏','üé≥','üéÆ','üé≤','‚ôüÔ∏è','ü•ä','‚õ≥','üèä','üèéÔ∏è', 'üßò', 'üç≥', 'üß†'].map(icon => ( <button key={icon} type="button" onClick={() => setNewGameIcon(icon)} className={`h-10 rounded-lg text-xl flex items-center justify-center transition-colors ${newGameIcon === icon ? 'bg-cyan-500/20 ring-2 ring-cyan-500' : 'bg-slate-950 hover:bg-slate-800'}`}>{icon}</button> ))}</div>
                      <button type="submit" className="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-lg transition-colors">Create Game</button>
                    </form>
                  </div>
                </div>
              )}
              {isWheelOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200">
                  <div className="bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl w-full max-w-md p-6 flex flex-col max-h-[80vh]">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold text-white flex items-center gap-2"><Settings className="text-pink-500" size={20}/> Wheel of Misfortune</h2><button onClick={() => setIsWheelOpen(false)} className="text-slate-400 hover:text-white"><X size={24}/></button></div>
                    <div className="flex-1 overflow-y-auto mb-4 space-y-2 pr-2">
                      <div className="bg-slate-950 rounded-xl p-6 text-center border-2 border-slate-800 mb-4 min-h-[120px] flex flex-col items-center justify-center">{isSpinning ? ( <RefreshCw className="w-8 h-8 text-pink-500 animate-spin" /> ) : wheelResult ? ( <div className="animate-in zoom-in duration-300"><p className="text-xs text-slate-500 uppercase font-bold mb-2">The loser must:</p><p className="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 leading-tight">{wheelResult}</p></div> ) : ( <p className="text-slate-600 text-sm font-medium">Spin to decide the loser's fate</p> )}</div>
                      <div className="space-y-2"><p className="text-xs font-bold text-slate-500 uppercase">Customise Forfeits</p>{forfeits.map((item, idx) => ( <div key={idx} className="flex justify-between items-center bg-slate-800/50 p-2 rounded border border-slate-800 text-sm"><span>{item}</span><button onClick={() => removeForfeit(item)} className="text-slate-500 hover:text-red-400"><X size={14}/></button></div> ))}</div>
                    </div>
                    <div className="mt-auto space-y-3 border-t border-slate-800 pt-4"><form onSubmit={addForfeit} className="flex gap-2"><input type="text" value={newForfeit} onChange={(e) => setNewForfeit(e.target.value)} placeholder="Add new forfeit..." className="flex-1 bg-slate-950 border border-slate-800 rounded px-3 py-2 text-sm focus:border-pink-500 outline-none" /><button type="submit" className="bg-slate-800 hover:bg-slate-700 px-3 rounded text-white"><Plus size={16}/></button></form><button onClick={spinWheel} disabled={isSpinning} className="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-3 rounded-lg shadow-lg transition-all active:scale-95 disabled:opacity-50">{isSpinning ? 'Spinning...' : 'SPIN THE WHEEL'}</button></div>
                  </div>
                </div>
              )}
              {isDisputeOpen && activeDisputeGame && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                  <div className="bg-slate-900 border-2 border-yellow-500/30 rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center"><div className="w-16 h-16 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-4"><HeartHandshake className="w-8 h-8 text-yellow-500" /></div><h2 className="text-xl font-bold text-white mb-2">The Supreme Court</h2><p className="text-slate-400 text-sm mb-6">To validate the result of <span className="text-white font-bold">{activeDisputeGame.name}</span>, the opposing party must digitally sign below.</p><div className="bg-slate-950 p-4 rounded-lg border border-slate-800 mb-6 text-left"><label className="flex items-start gap-3 cursor-pointer group"><input type="checkbox" className="peer h-5 w-5 rounded border border-slate-600 checked:bg-yellow-500" id="agreement" /><span className="text-xs text-slate-500 group-hover:text-slate-300 transition-colors">I hereby confirm that the result was valid, fair, and not a "trial run".</span></label></div><div className="grid grid-cols-2 gap-3"><button onClick={() => setIsDisputeOpen(false)} className="py-3 text-slate-400 hover:text-white font-medium">Cancel</button><button onClick={resolveDispute} className="py-3 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg font-bold shadow-lg shadow-yellow-500/20 transition-colors">Confirm & Seal</button></div></div>
                </div>
              )}

              {/* SECRET MODAL */}
              {isSecretModalOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
                   <div className="w-full max-w-xs text-center">
                       <h2 className="text-slate-600 font-mono text-xs mb-4 uppercase tracking-widest">System Diagnostic</h2>
                       <form onSubmit={handleSecretSubmit}>
                           <input type="text" autoFocus value={secretCode} onChange={(e) => setSecretCode(e.target.value)} className="bg-transparent border-b border-slate-800 w-full text-center text-xl tracking-widest text-slate-500 focus:outline-none focus:border-cyan-500 uppercase font-mono" placeholder="ACCESS CODE" />
                       </form>
                       <button onClick={() => setIsSecretModalOpen(false)} className="mt-8 text-slate-700 text-xs hover:text-slate-500">ABORT</button>
                   </div>
                </div>
              )}

            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
